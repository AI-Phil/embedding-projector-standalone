<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astra DB Helper</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
        }
        label {
            display: block;
            margin-top: 1em;
        }
        input[type="text"],
        input[type="password"] {
            width: 300px;
            padding: 0.5em;
            margin-top: 0.2em;
        }
        button {
            padding: 0.7em 1.5em;
            margin-top: 1em;
            cursor: pointer;
        }
        .hidden {
            display: none;
        }
        #results,
        #error {
            margin-top: 1em;
            padding: 1em;
            border: 1px solid #ccc;
        }
        #error {
            border-color: red;
            color: red;
        }
        #collections-list,
        #sample-data {
            margin-top: 0.5em;
        }
        pre {
            background-color: #f4f4f4;
            padding: 1em;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Astra DB Connection & Sampling Helper</h1>

    <section id="connection-section">
        <h2>1. Connect to Astra DB</h2>
        <form id="connection-form">
            <div>
                <label for="db_name">Connection Nickname (for display):</label>
                <input type="text" id="db_name" name="db_name" placeholder="e.g., my-dev-db" required>
            </div>
            <div>
                <label for="endpoint_url">Astra Data API Endpoint URL:</label>
                <input type="text" id="endpoint_url" name="endpoint_url" placeholder="https://<db-id>-<region>.apps.astra.datastax.com/api/json/v1" required>
            </div>
            <div>
                <label for="token">Astra Application Token:</label>
                <input type="password" id="token" name="token" placeholder="AstraCS:..." required>
            </div>
            <div>
                <label for="keyspace">Keyspace/Namespace (Optional):</label>
                <input type="text" id="keyspace" name="keyspace" placeholder="default_keyspace">
            </div>
            <button type="submit">Connect & List Collections</button>
        </form>
    </section>

    <section id="collections-section" class="hidden">
        <h2>2. Select Collection</h2>
        <div id="collections-list">
            <!-- Collection list will be populated here -->
        </div>
        <button id="sample-button" disabled>Fetch Sample & Metadata Keys</button>
    </section>

    <section id="metadata-selection-section" class="hidden">
        <h2>3. Select Metadata Fields</h2>
        <p>Select the fields to include in the metadata TSV file. The <code>_id</code> field is selected by default.</p>
        <div id="metadata-keys-list">
            <!-- Checkboxes for metadata keys will be populated here -->
        </div>
        <div>
             <label for="tensor_name_override" style="margin-top: 1em;">Tensor Name (Optional Override):</label>
             <input type="text" id="tensor_name_override" name="tensor_name_override" placeholder="Default: [Nickname]_[CollectionName]" style="width: 300px;">
        </div>
        <div class="form-group" style="margin-top: 1em;">
            <label for="doc_limit_input">Document Limit (Optional):</label>
            <input type="number" id="doc_limit_input" name="doc_limit" min="1" placeholder="Leave blank for all documents" style="width: 300px; padding: 0.5em;">
            <small id="doc_limit_help_text" style="display: block; margin-top: 0.3em; color: #6c757d;">Specify the maximum number of documents to fetch and save.</small>
        </div>
        <button id="preview-docs-button" style="margin-top: 1em;">Preview Sampled Documents</button>
        <button id="generate-config-button" disabled>Generate Projector Config & TSV</button>
    </section>

    <section id="sampling-preview-section" class="hidden">
        <h2>Sample Data Preview</h2>
        <div id="sample-data">
            <!-- Sample data preview will be shown here -->
        </div>
    </section>

    <section id="config-section" class="hidden">
        <h2>4. Generated Configuration & Metadata</h2>
        <p>Save the following content into files (`config.json`, `data.json`, `metadata.tsv`) in your projector directory:</p>
        <div>
            <label for="config-json">config.json:</label>
            <textarea id="config-json" rows="10" cols="80" readonly></textarea>
        </div>
        <div>
            <label for="data-json">data.json (Vector Data Only):</label>
            <textarea id="data-json" rows="10" cols="80" readonly></textarea>
        </div>
        <div>
            <label for="metadata-tsv">metadata.tsv:</label>
            <textarea id="metadata-tsv" rows="10" cols="80" readonly></textarea>
        </div>
    </section>

    <hr>
    <div id="results">Status: Waiting for connection details...</div>
    <div id="error" class="hidden"></div>

    <script src="/static/js/astra_helper.js" defer></script>

</body>
</html>